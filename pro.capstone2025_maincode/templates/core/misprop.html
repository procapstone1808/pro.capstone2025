{% extends "base.html" %}
{% load static %}

{% block nav_items %}
  <li class="nav-item"><a class="nav-link fw-semibold" href="{% url 'core:perfil' %}">Perfil</a></li>
  <li class="nav-item"><a class="nav-link fw-semibold" href="">Mis Propiedades</a></li>
  <li class="nav-item"><a class="nav-link fw-semibold" href="{% url 'core:ayuda' %}">Ayuda</a></li>
  
{% endblock %}

{% block title %}Mis propiedades{% endblock %}




{% block content %}

<!--CAMBIAR ESTE CODIGO A ARCHIVO CSS MAS ADELANTE!!-->
<style>
.cards-wrap{
  display:flex;
  flex-wrap:wrap;
  gap:16px;                 /* separación de cards */
}

.cards-wrap .card{ width:25rem; }

.card-img-top{ height:160px; object-fit:cover; }
</style>

<div class="cards-wrap">

  {# Card fija: Crear una nueva propiedad #}
  <div class="card">
    <img class="card-img-top" src="{% static 'img/crear-prop.jpg' %}" alt="propiedad">
    <div class="card-body">
      <p class="card-text">Crear una nueva propiedad</p>
      <a class="btn btn-primary" href="{% url 'core:createform' %}">Ingresar</a>
    </div>
  </div>



  {# Cards dinámicas: una por cada propiedad existente #}
  {% for p in propiedades %}
    <div class="card">
      {% if p.imagen %}
        <img class="card-img-top" src="{{ p.imagen.url }}" alt="{{ p.direccion }}">
      {% else %}
        {# imagen por defecto si no se subió ninguna #}
        <img class="card-img-top" src="{% static 'img/propiedad-default.jpg' %}" alt="propiedad">
      {% endif %}

      <div class="card-body">
        <p class="card-text fw-semibold">{{ p.direccion }}</p>

        <p class="text-muted small mb-2">
          Rol {{ p.rol_sii }} · {{ p.comuna }}, {{ p.region }}
        </p>

        <a class="btn btn-primary" href="{% url 'core:editarform' p.propiedad_id %}">
          Editar
        </a>
      </div>
    </div>
  {% empty %}
    <p>No hay propiedades registradas todavía.</p>
  {% endfor %}

</div>
<!--Formulario para eliminar propiedad-->
<form action=""
      method="post"
      style="display:inline;">
    {% csrf_token %}
    <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('¿Deseas eliminar esta propiedad?')";>Eliminar</button>
</form>


  {# Cards dinámicas: una por cada propiedad existente #}
  {% for p in propiedades %}
    <div class="card">
      {% if p.imagen %}
        <img class="card-img-top" src="{{ p.imagen.url }}" alt="{{ p.direccion }}">
      {% else %}
        {# imagen por defecto si no se subió ninguna #}
        <img class="card-img-top" src="{% static 'img/propiedad-default.jpg' %}" alt="propiedad">
      {% endif %}


      <div class="card-body">
        <p class="card-text fw-semibold">{{ p.direccion }}</p>

        <p class="text-muted small mb-2">
          Rol {{ p.rol_sii }} · {{ p.comuna }}, {{ p.region }}
        </p>

        <a class="btn btn-primary" href="{% url 'core:editarform' p.propiedad_id %}">
          Editar
        </a>
      </div>
    </div>
  {% empty %}
    <p>No hay propiedades registradas todavía.</p>
  {% endfor %}

</div>

{% endblock %}